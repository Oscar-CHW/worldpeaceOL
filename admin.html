<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="admin_panel">ç®¡ç†å‘˜é¢æ¿ - å¤©ä¸‹å¤ªå¹³</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="theme-color" content="#4a69bd">
    <!-- Preload critical assets -->
    <link rel="preload" href="js/ui-enhancement.js" as="script">
</head>
<body class="loading admin-page">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div id="language-selector" class="glass"></div>
    
    <div class="header glass">
        <a href="/" class="site-title" data-i18n="title">å¤©ä¸‹å¤ªå¹³</a>
        <div class="nav-links">
            <a href="/dashboard.html" data-i18n="dashboard">æ§åˆ¶å°</a>
            <a href="/admin.html" data-i18n="admin_panel" class="active">ç®¡ç†å‘˜é¢æ¿</a>
        </div>
        <div class="auth-links">
            <a href="#" id="logout-btn" data-i18n="logout">ç™»å‡º</a>
        </div>
    </div>
    
    <div class="container content-wide" id="main-content">
        <div class="admin-container card">
            <div class="admin-header">
                <h2 data-i18n="admin_panel">ç®¡ç†å‘˜é¢æ¿</h2>
                <div class="server-status">
                    <span data-i18n="server_status">æœåŠ¡å™¨çŠ¶æ€</span>: 
                    <span id="server-status" class="status-online">åœ¨çº¿</span>
                </div>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" id="users-tab" data-i18n="manage_users">ç”¨æˆ·ç®¡ç†</button>
                <button class="admin-tab" id="games-tab" data-i18n="manage_games">æ¸¸æˆç®¡ç†</button>
                <button class="admin-tab" id="logs-tab" data-i18n="system_logs">ç³»ç»Ÿæ—¥å¿—</button>
                <button class="admin-tab" id="settings-tab" data-i18n="system_settings">ç³»ç»Ÿè®¾ç½®</button>
            </div>
            
            <div class="admin-content">
                <!-- Users Tab -->
                <div class="admin-panel active" id="users-panel">
                    <div class="panel-header glass">
                        <h3 data-i18n="manage_users">ç”¨æˆ·ç®¡ç†</h3>
                        <div class="panel-actions">
                            <div class="search-container">
                                <input type="text" id="user-search" data-i18n-placeholder="search_users" class="search-input" placeholder="æœç´¢ç”¨æˆ·...">
                                <span class="search-icon" aria-label="Search" role="button" tabindex="0">ğŸ”</span>
                            </div>
                            <button id="add-user-btn" class="primary-button" data-i18n="add_user">æ·»åŠ ç”¨æˆ·</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="users-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th data-i18n="id">ID</th>
                                    <th data-i18n="username">ç”¨æˆ·å</th>
                                    <th data-i18n="elo_rating">Eloè¯„åˆ†</th>
                                    <th data-i18n="role">è§’è‰²</th>
                                    <th data-i18n="last_login">æœ€åç™»å½•</th>
                                    <th data-i18n="actions">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="6" class="table-loading">
                                        <div class="loading-indicator">
                                            <div class="spinner"></div>
                                            <span data-i18n="loading_users">åŠ è½½ç”¨æˆ·æ•°æ®...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prev-page" class="pagination-btn" disabled>&lt;</button>
                        <span id="page-info">1 / 1</span>
                        <button id="next-page" class="pagination-btn" disabled>&gt;</button>
                    </div>
                </div>
                
                <!-- Games Tab -->
                <div class="admin-panel" id="games-panel">
                    <div class="panel-header glass">
                        <h3 data-i18n="manage_games">æ¸¸æˆç®¡ç†</h3>
                        <div class="panel-actions">
                            <div class="filter-group">
                                <label for="game-status-filter" data-i18n="status">çŠ¶æ€</label>
                                <select id="game-status-filter">
                                    <option value="all" data-i18n="all">å…¨éƒ¨</option>
                                    <option value="active" data-i18n="active">æ´»è·ƒ</option>
                                    <option value="completed" data-i18n="completed">å·²å®Œæˆ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="games-table" class="admin-table">
                            <thead>
                                <tr>
                                    <th data-i18n="game_id">æ¸¸æˆID</th>
                                    <th data-i18n="game_mode">æ¸¸æˆæ¨¡å¼</th>
                                    <th data-i18n="players">ç©å®¶</th>
                                    <th data-i18n="status">çŠ¶æ€</th>
                                    <th data-i18n="created_at">åˆ›å»ºæ—¶é—´</th>
                                    <th data-i18n="actions">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="games-table-body">
                                <tr>
                                    <td colspan="6" class="table-loading">
                                        <div class="loading-indicator">
                                            <div class="spinner"></div>
                                            <span data-i18n="loading_games">åŠ è½½æ¸¸æˆæ•°æ®...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Logs Tab -->
                <div class="admin-panel" id="logs-panel">
                    <div class="panel-header glass">
                        <h3 data-i18n="system_logs">ç³»ç»Ÿæ—¥å¿—</h3>
                        <div class="panel-actions">
                            <div class="filter-group">
                                <label for="log-level-filter" data-i18n="level">çº§åˆ«</label>
                                <select id="log-level-filter">
                                    <option value="all" data-i18n="all">å…¨éƒ¨</option>
                                    <option value="error" data-i18n="error">é”™è¯¯</option>
                                    <option value="warn" data-i18n="warning">è­¦å‘Š</option>
                                    <option value="info" data-i18n="info">ä¿¡æ¯</option>
                                </select>
                            </div>
                            <button id="clear-logs-btn" class="danger-button" data-i18n="clear_logs">æ¸…é™¤æ—¥å¿—</button>
                        </div>
                    </div>
                    
                    <div class="logs-container glass">
                        <div id="logs-output" class="logs-output">
                            <div class="loading-indicator">
                                <div class="spinner"></div>
                                <span data-i18n="loading_logs">åŠ è½½æ—¥å¿—æ•°æ®...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="admin-panel" id="settings-panel">
                    <div class="panel-header glass">
                        <h3 data-i18n="system_settings">ç³»ç»Ÿè®¾ç½®</h3>
                        <div class="panel-actions">
                            <button id="save-settings-btn" class="primary-button" data-i18n="save_settings">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>
                    
                    <form id="settings-form" class="settings-form">
                        <div class="settings-section glass">
                            <h4 data-i18n="general_settings">ä¸€èˆ¬è®¾ç½®</h4>
                            <div class="form-group">
                                <label for="site-name" data-i18n="site_name">ç½‘ç«™åç§°</label>
                                <input type="text" id="site-name" value="å¤©ä¸‹å¤ªå¹³">
                            </div>
                            <div class="form-group">
                                <label for="maintenance-mode" class="checkbox-label">
                                    <input type="checkbox" id="maintenance-mode">
                                    <span data-i18n="maintenance_mode">ç»´æŠ¤æ¨¡å¼</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-section glass">
                            <h4 data-i18n="game_settings">æ¸¸æˆè®¾ç½®</h4>
                            <div class="form-group">
                                <label for="max-active-games" data-i18n="max_active_games">æœ€å¤§æ´»è·ƒæ¸¸æˆæ•°</label>
                                <input type="number" id="max-active-games" value="1000" min="10" max="10000">
                            </div>
                            <div class="form-group">
                                <label for="default-elo" data-i18n="default_elo">é»˜è®¤ELOå€¼</label>
                                <input type="number" id="default-elo" value="1200" min="1000" max="2000">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- User Edit Modal -->
        <div id="user-modal" class="modal" aria-labelledby="user-modal-title" aria-hidden="true">
            <div class="modal-content glass">
                <div class="modal-header">
                    <h3 id="user-modal-title" data-i18n="edit_user">ç¼–è¾‘ç”¨æˆ·</h3>
                    <span class="close-modal" aria-label="Close">&times;</span>
                </div>
                <form id="user-form">
                    <div class="form-group">
                        <label for="user-username" data-i18n="username">ç”¨æˆ·å</label>
                        <input type="text" id="user-username" required>
                    </div>
                    <div class="form-group">
                        <label for="user-role" data-i18n="role">è§’è‰²</label>
                        <select id="user-role">
                            <option value="USER" data-i18n="user">ç”¨æˆ·</option>
                            <option value="ADMIN" data-i18n="admin">ç®¡ç†å‘˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-elo" data-i18n="elo_rating">Eloè¯„åˆ†</label>
                        <input type="number" id="user-elo" min="1" max="3000">
                    </div>
                    <div class="form-group">
                        <label for="user-password" data-i18n="password">å¯†ç </label>
                        <input type="password" id="user-password" placeholder="Leave blank to keep unchanged">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="primary-button" data-i18n="save">ä¿å­˜</button>
                        <button type="button" id="cancel-user-edit" class="secondary-button" data-i18n="cancel">å–æ¶ˆ</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Add offline support notification -->
        <div id="offline-notification" class="hidden">
            You are currently offline. Some features may be limited.
        </div>
    </div>
    
    <script src="js/common.js"></script>
    <script type="module" src="js/pages/admin.js"></script>
    <script src="js/ui-enhancement.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Offline detection
            window.addEventListener('online', function() {
                document.getElementById('offline-notification').classList.add('hidden');
            });
            
            window.addEventListener('offline', function() {
                document.getElementById('offline-notification').classList.remove('hidden');
            });
            
            // Check initial state
            if (!navigator.onLine) {
                document.getElementById('offline-notification').classList.remove('hidden');
            }
            
            // Tab functionality
            const tabs = document.querySelectorAll('.admin-tab');
            const panels = document.querySelectorAll('.admin-panel');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all panels
                    panels.forEach(panel => panel.classList.remove('active'));
                    
                    // Show the corresponding panel
                    const panelId = this.id.replace('-tab', '-panel');
                    document.getElementById(panelId).classList.add('active');
                });
            });
            
            // Modal functionality
            const userModal = document.getElementById('user-modal');
            const closeModal = userModal.querySelector('.close-modal');
            const cancelBtn = document.getElementById('cancel-user-edit');
            
            closeModal.addEventListener('click', function() {
                userModal.style.display = 'none';
                userModal.setAttribute('aria-hidden', 'true');
            });
            
            cancelBtn.addEventListener('click', function() {
                userModal.style.display = 'none';
                userModal.setAttribute('aria-hidden', 'true');
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === userModal) {
                    userModal.style.display = 'none';
                    userModal.setAttribute('aria-hidden', 'true');
                }
            });
            
            // Example function to open user modal (to be called from admin.js)
            window.openUserModal = function(userData) {
                document.getElementById('user-modal-title').textContent = userData ? 'Edit User' : 'Add New User';
                document.getElementById('user-username').value = userData ? userData.username : '';
                document.getElementById('user-role').value = userData ? userData.role : 'USER';
                document.getElementById('user-elo').value = userData ? userData.elo : 1200;
                document.getElementById('user-password').value = '';
                
                userModal.style.display = 'block';
                userModal.setAttribute('aria-hidden', 'false');
                document.getElementById('user-username').focus();
            };
            
            // Add user button click handler
            document.getElementById('add-user-btn').addEventListener('click', function() {
                window.openUserModal(null);
            });
        });
    </script>
</body>
</html> 