<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="World Peace Online - A strategic multiplayer game inspired by classic strategy games">
    <title>天下太平 - World Peace Online</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
    <!-- NES.css -->
    <link href="https://unpkg.com/nes.css@latest/css/nes.min.css" rel="stylesheet" />
    <!-- Foundation Grid -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/css/foundation-float.min.css" crossorigin="anonymous">
    <!-- Main CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Preload critical assets -->
    <link rel="preload" href="images/bg.png" as="image">
    <!-- Favicon -->
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <!-- Apple touch icon for iOS devices -->
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <!-- Add theme color for browser UI -->
    <meta name="theme-color" content="#0f172a">
    <style>
  .nes-only { display: none !important; }
</style>
</head>
<body class="loading">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Theme Switcher -->
    <!-- <div class="theme-switcher">
        <div class="theme-toggle standard-theme active" id="standard-theme">Modern</div>
        <div class="theme-toggle nes-theme" id="nes-theme">Retro</div>
    </div> -->

    <header class="header">
    <div class="container">
        <div class="flex justify-between items-center">
            <div class="site-title-wrapper">
                <a href="/" class="site-title" data-i18n="title">天下太平</a>
            </div>
            <button class="nav-toggle show-for-small-only" id="nav-toggle">☰</button>
            <div class="nav-links hide-for-small-only">
                <a href="/" class="home-btn standard-only">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="/" class="home-btn nes-btn nes-only">
                    <i class="nes-icon is-small star"></i> Home
                </a>
                <a href="/dashboard.html" data-i18n="dashboard" class="standard-only">控制台</a>
                <a href="/friends.html" data-i18n="friends" class="standard-only">好友</a>
                <a href="/pairing.html" data-i18n="matchmaking" class="standard-only">匹配</a>
                <a href="/dashboard.html" data-i18n="dashboard" class="nes-btn nes-only">控制台</a>
                <a href="/friends.html" data-i18n="friends" class="nes-btn nes-only">好友</a>
                <a href="/pairing.html" data-i18n="matchmaking" class="nes-btn nes-only">匹配</a>
            </div>
            <div class="auth-links hide-for-small-only">
                <div class="user-welcome" id="user-welcome">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <a href="#" id="logout-btn" class="btn standard-only" data-i18n="logout">登出</a>
                    <a href="#" id="logout-btn-nes" class="nes-btn is-error nes-only" data-i18n="logout">登出</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobile-nav">
        <div class="nav-links">
            <a href="/" class="home-btn standard-only">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="/" class="home-btn nes-btn nes-only">
                <i class="nes-icon is-small star"></i> Home
            </a>
            <a href="/dashboard.html" data-i18n="dashboard" class="standard-only">控制台</a>
            <a href="/friends.html" data-i18n="friends" class="standard-only">好友</a>
            <a href="/pairing.html" data-i18n="matchmaking" class="standard-only">匹配</a>
            <a href="/dashboard.html" data-i18n="dashboard" class="nes-btn nes-only">控制台</a>
            <a href="/friends.html" data-i18n="friends" class="nes-btn nes-only">好友</a>
            <a href="/pairing.html" data-i18n="matchmaking" class="nes-btn nes-only">匹配</a>
        </div>
        <div class="auth-links">
            <div class="user-welcome" id="mobile-user-welcome">
                <div class="user-avatar" id="mobile-user-avatar">U</div>
                <span class="username" id="mobile-username-display">Username</span>
                <a href="#" id="mobile-logout-btn" class="btn standard-only" data-i18n="logout">登出</a>
                <a href="#" id="mobile-logout-btn-nes" class="nes-btn is-error nes-only" data-i18n="logout">登出</a>
            </div>
        </div>
    </div>
</header>

    <main class="main-content" id="main-content">
        <div class="container">
            <!-- Standard Theme Content -->
            <div class="title-container card standard-only">
                <div class="game-badge">BETA</div>
                <h1 class="float">天下太平</h1>
                <div class="player-count">
                    <span id="player-count">7</span> players online
                </div>
                <div class="game-quotes">
                    <p class="game-quote">"The art of war is of vital importance to the State." — Sun Tzu</p>
                    <p class="game-quote">"War is peace. Freedom is slavery. Ignorance is strength." — George Orwell, 1984</p>
                </div>

                <div class="game-mode-description" id="mode-description">
                    The original strategy game experience. Build armies, collect resources, and work toward world peace.
                </div>
            
                <div class="last-room-prompt hidden" id="last-room-prompt">
                    <p>You have an active room:</p>
                    <p id="last-room-id"></p>
                    <button class="btn" id="rejoin-btn">Rejoin Room</button>
                </div>
                
                <section class="matchmaking-section">
                    <h2 class="section-title">Matchmaking</h2>
                    <div class="grid matchmaking-options" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                        <div class="matchmaking-card" id="quick-match">
                            <div class="matchmaking-icon">⚡</div>
                            <h3>Quick Match</h3>
                            <p>Join the queue for instant matchmaking with players of similar skill</p>
                        </div>
                        
                        <div class="matchmaking-card" id="friend-battle">
                            <div class="matchmaking-icon">👥</div>
                            <h3>Friend Battle</h3>
                            <p>Challenge your friends to a private match</p>
                        </div>
                        
                        <div class="matchmaking-card" id="custom-room">
                            <div class="matchmaking-icon">🔧</div>
                            <h3>Custom Room</h3>
                            <p>Create a room with customized settings and rules</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- NES Theme Content -->
            <div class="title-container nes-container is-rounded with-title nes-only">
                <p class="title">World Peace Online</p>
                <span class="game-badge nes-badge"><span class="is-warning">BETA</span></span>
                <h1 class="title-glow nes-text is-primary">天下太平</h1>
                <div class="player-count">
                    <span id="player-count-nes">7</span> players online
                </div>
                <p class="game-quote nes-text">"The art of war is of vital importance to the State." — Sun Tzu</p>
                <p class="game-quote nes-text">"War is peace. Freedom is slavery. Ignorance is strength."― George Orwell, 1984</p>

                <div class="game-mode-description nes-text" id="mode-description-nes">
                    The original strategy game experience. Build armies, collect resources, and work toward world peace.
                </div>
            
                <div class="last-room-prompt hidden nes-container is-rounded" id="last-room-prompt-nes">
                    <p>You have an active room:</p>
                    <p id="last-room-id-nes"></p>
                    <button class="nes-btn is-success" id="rejoin-btn-nes">Rejoin Room</button>
                </div>
            
                <!-- Matchmaking Options -->
                <div class="matchmaking-options">
                    <h3 class="matchmaking-title nes-text">Matchmaking</h3>
                    <div class="grid-x grid-margin-x align-center">
                        <div class="cell small-12 medium-4">
                            <div class="matchmaking-card nes-container is-rounded" id="quick-match-nes">
                                <div class="matchmaking-icon">⚡</div>
                                <h4 class="nes-text">Quick Match</h4>
                                <p>Join the queue for instant matchmaking with players of similar skill</p>
                            </div>
                        </div>
                        
                        <div class="cell small-12 medium-4">
                            <div class="matchmaking-card nes-container is-rounded" id="friend-battle-nes">
                                <div class="matchmaking-icon">👥</div>
                                <h4 class="nes-text">Friend Battle</h4>
                                <p>Challenge your friends to a private match</p>
                            </div>
                        </div>
                        
                        <div class="cell small-12 medium-4">
                            <div class="matchmaking-card nes-container is-rounded" id="custom-room-nes">
                                <div class="matchmaking-icon">🔧</div>
                                <h4 class="nes-text">Custom Room</h4>
                                <p>Create a room with customized settings and rules</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Language selector -->
    <div id="language-selector" class="language-selector"></div>
    
    <!-- Join Room Modal -->
    <div id="join-room-modal" class="reveal" data-reveal aria-labelledby="join-room-title" aria-hidden="true">
        <!-- NES Theme Modal -->
        <div class="nes-container is-rounded with-title nes-only">
            <p class="title" id="join-room-title">Join Room</p>
            <button class="close-button" data-close aria-label="Close" type="button">
                <span aria-hidden="true">&times;</span>
            </button>
            <form id="join-room-form">
                <div class="nes-field">
                    <input type="text" class="nes-input" id="room-id-input" placeholder="Enter Room ID" aria-label="Room ID" required>
                </div>
                <button type="submit" class="nes-btn is-primary" id="join-submit-btn">Join</button>
            </form>
        </div>
        
        <!-- Standard Theme Modal -->
        <div class="card standard-only">
            <h3 id="join-room-title-standard">Join Room</h3>
            <button class="close-button" data-close aria-label="Close" type="button">
                <span aria-hidden="true">&times;</span>
            </button>
            <form id="join-room-form-standard">
                <div class="form-group">
                    <input type="text" id="room-id-input-standard" placeholder="Enter Room ID" aria-label="Room ID" required>
                </div>
                <button type="submit" class="btn" id="join-submit-btn-standard">Join</button>
            </form>
        </div>
    </div>
    
    <!-- Offline notifications -->
    <div id="offline-notification" class="nes-container is-rounded is-error hidden nes-only offline-notification">
        <i class="nes-icon is-small warning"></i> You are currently offline. Some features may be limited.
    </div>
    
    <div id="offline-notification-standard" class="offline-notification hidden standard-only">
        You are currently offline. Some features may be limited.
    </div>
    
    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.7.5/dist/js/foundation.min.js"></script>
    <script>$(document).foundation();</script>
    <script type="module" src="js/pages/index.js"></script>
    <script type="module" src="js/common.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize
            setTimeout(() => document.body.classList.remove('loading'), 100);
            
            // Mobile navigation toggle
            const navToggle = document.getElementById('nav-toggle');
            const mobileNav = document.getElementById('mobile-nav');
            
            if (navToggle && mobileNav) {
                navToggle.addEventListener('click', function() {
                    mobileNav.classList.toggle('active');
                });
            }
            
            // Header scroll behavior
            let lastScrollTop = 0;
            const header = document.querySelector('.header');
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    // Scrolling down & past threshold
                    header.classList.add('collapsed');
                    header.classList.remove('visible');
                } else {
                    // Scrolling up
                    header.classList.remove('collapsed');
                    header.classList.add('visible');
                }
                
                lastScrollTop = scrollTop;
            });
            
            // Auth status check and display
            function checkAuthStatus() {
                // This will be set by the auth-status.js script
                if (window.isLoggedIn) {
                    // Hide login/signup buttons
                    document.getElementById('auth-buttons').classList.add('hidden');
                    document.getElementById('mobile-auth-buttons').classList.add('hidden');
                    
                    // Show user welcome
                    document.getElementById('user-welcome').classList.remove('hidden');
                    document.getElementById('mobile-user-welcome').classList.remove('hidden');
                    
                    // Set username
                    if (window.currentUser) {
                        const displayName = window.currentUser.username || 'User';
                        const firstLetter = displayName.charAt(0).toUpperCase();
                        
                        document.getElementById('username-display').textContent = displayName;
                        document.getElementById('mobile-username-display').textContent = displayName;
                        document.getElementById('user-avatar').textContent = firstLetter;
                        document.getElementById('mobile-user-avatar').textContent = firstLetter;
                    }
                } else {
                    // Show login/signup buttons
                    document.getElementById('auth-buttons').classList.remove('hidden');
                    document.getElementById('mobile-auth-buttons').classList.remove('hidden');
                    
                    // Hide user welcome
                    document.getElementById('user-welcome').classList.add('hidden');
                    document.getElementById('mobile-user-welcome').classList.add('hidden');
                }
            }
            
            // Check auth status when the window loads and when auth status changes
            window.addEventListener('load', checkAuthStatus);
            document.addEventListener('auth-status-changed', checkAuthStatus);
            
            // Offline detection
            window.addEventListener('online', function() {
                document.querySelectorAll('.offline-notification').forEach(el => {
                    el.classList.add('hidden');
                });
            });
            
            window.addEventListener('offline', function() {
                document.querySelectorAll('.offline-notification').forEach(el => {
                    el.classList.remove('hidden');
                });
            });
            
            // Check initial state
            if (!navigator.onLine) {
                document.querySelectorAll('.offline-notification').forEach(el => {
                    el.classList.remove('hidden');
                });
            }
            
            // Connect buttons to their functions
            document.getElementById('quick-match').addEventListener('click', function() {
                window.location.href = '/pairing.html';
            });
            
            document.getElementById('friend-battle').addEventListener('click', function() {
                window.location.href = '/friends.html';
            });
            
            document.getElementById('custom-room').addEventListener('click', function() {
                window.location.href = '/create-room.html';
            });
            
            // Connect NES theme buttons
            document.getElementById('quick-match-nes').addEventListener('click', function() {
                window.location.href = '/pairing.html';
            });
            
            document.getElementById('friend-battle-nes').addEventListener('click', function() {
                window.location.href = '/friends.html';
            });
            
            document.getElementById('custom-room-nes').addEventListener('click', function() {
                window.location.href = '/create-room.html';
            });
            
            // Sync player counts
            document.getElementById('player-count').textContent = 
                document.getElementById('player-count-nes').textContent = 
                document.getElementById('player-count').textContent || '7';
        });
    </script>
</body>
</html>